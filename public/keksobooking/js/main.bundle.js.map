{"version":3,"sources":["webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/utils.js","webpack://keksobooking/./source/js/ads.js","webpack://keksobooking/./source/js/store.js","webpack://keksobooking/./source/js/popup.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/api.js","webpack://keksobooking/./source/js/filter.js","webpack://keksobooking/./source/js/main.js"],"names":["DEFAULT_COORD","lat","lng","MAIN_ICON","iconSize","iconAnchor","iconUrl","ICON","LEAFLET","L","MAP","map","MARKERS","removePins","forEach","marker","remove","mainMarker","pluralize","n","variants","getRoundNumber","number","digits","degree","Math","pow","round","hasObjKey","obj","key","Object","prototype","hasOwnProperty","call","CARD_TEMPLATE","document","querySelector","HOUSE_TYPES","palace","flat","house","bungalow","SELECTORS","title","address","price","type","capacity","time","features","description","photos","avatar","ROOMS_OPTIONS","GUESTS_OPTIONS","rawData","preparedData","prepareData","filterData","Error","data","filter","length","slice","sliceCounts","getData","storeData","MAIN_BLOCK","onPopupEscKeydown","evt","isEscEvent","preventDefault","closePopup","onPopupClick","openPopup","node","parent","className","popup","content","cloneNode","style","zIndex","appendChild","addEventListener","lastChild","lastElementChild","removeChild","removeEventListener","AD_FORM","AD_FORM_RESET","MAP_FILTERS","PHOTO_AVATAR_PREVIEW","PHOTO_HOUSE_PREVIEW","CLONE_PHOTO","POPUP_SUCCESS_TEMPLATE","POPUP_ERROR_TEMPLATE","FieldNodes","TYPE","PRICE","TIMEIN","TIMEOUT","ADDRESS","ROOM_NUMBER","CAPACITY","PHOTO_AVATAR","PHOTO_HOUSE","FILE_TYPES","HOUSE_PRICE","ROOMS_VALUES","1","2","3","100","fieldPhotoAvatarChangeHandler","FILE","target","files","FILE_NAME","name","toLowerCase","some","file","endsWith","READER","FileReader","src","result","readAsDataURL","fieldPhotoHouseChangeHandler","CLONE","width","height","fieldRoomNumberChangeHandler","value","querySelectorAll","elem","changeAttribute","includes","attr1","attr2","removeAttribute","setAttribute","disableFormFields","childFields","classNode","classList","add","enableFormFields","fieldTypeChangeHandler","fieldTimeinChangeHandler","fieldTimeoutChangeHandler","resetFormHandler","reset","setView","setLatLng","setAddress","submitFormHandler","formData","FormData","fetch","method","body","then","response","ok","json","status","statusText","catch","filterChangeHandler","addEventListeners","DEFAULT_FEATURES_VALUES","SelectKeys","DEFAULT_VALUES","actualValues","checkSelectKeys","checkPrice","checkData","offer","rooms","guests","replace","checkFeatures","adaptPoints","ad","location","renderPins","points","onClick","idx","icon","bindPopup","cardData","adNodes","selectors","nodes","keys","entries","getNodes","textContent","titles","getAddressCoords","innerHTML","getCapacityText","checkin","checkout","child","feature","imgElement","img","fragment","createDocumentFragment","newImg","renderPhotos","author","fillCard","keepInView","addTo","push","addPins","updatePinsDebounced","_","debounce","handleDataSuccess","setSelect","setCheckbox","handleSelectChange","handleCheckboxChange","field","tagName","id","checked","handleDataError","alertContainer","createElement","append","setTimeout","args","setFieldValue","setCheckboxValue","removeEventListeners","onLoad","onPinMove","on","tileLayer","attribution","mainIcon","draggable","getLatLng","initMap"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const DEFAULT_COORD = {\n  lat: 35.68951,\n  lng: 139.69171,\n};\n\nconst VIEW_MAP = 10;\nconst LEAFLET_TILE_URL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';\nconst LEAFLET_ATTR = '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\n\nconst MAIN_ICON = {\n  iconSize: [52, 52],\n  iconAnchor: [26, 52],\n  iconUrl: 'img/main-pin.svg',\n};\n\nconst ICON = {\n  iconSize: [40, 40],\n  iconAnchor: [20, 20],\n  iconUrl: 'img/pin.svg',\n};\n\n// eslint-disable-next-line\nconst LEAFLET = L;\nconst MAP = LEAFLET.map('map-canvas');\nlet MARKERS = [];\n\nconst removePins = () => {\n  MARKERS.forEach((marker) => {\n    marker.remove();\n  })\n};\n\n/**\n * 1 рендер пинов\n * 2 привязка обработчика клика по пину\n * @param {*} points - {lat, lng, title}\n * @param {*} onClick - обработчик клика по пину\n */\nconst addPins = (points, onClick) => {\n\n  const addPin = ({lat, lng}, idx) => {\n    const icon = LEAFLET.icon(ICON);\n    const marker = LEAFLET.marker({lat, lng}, {icon});\n\n    marker.bindPopup(\n      () => onClick(idx),\n      {keepInView: true},\n    );\n    marker.addTo(MAP);\n    MARKERS.push(marker);\n  };\n\n  points.forEach(addPin);\n};\n\nlet mainMarker;\n\nconst moveMainMarkerDefault = () => {\n  MAP.setView(DEFAULT_COORD)\n  mainMarker.setLatLng(DEFAULT_COORD);\n};\n\n/**\n * Инициализация карты\n * 1 рендер главного пина\n * 2 вызов обработчика завершения загрузки карты\n * 3 привязка обработчика перемещения главного пина\n * @param {*} onLoad - обработчик успешной загрузки карты\n * @param {*} onPinMove - обработчик перемещения главного пина\n */\nfunction initMap(onLoad, onPinMove) {\n  const mainPinMoveHandler = (evt) => {\n    onPinMove(evt.target.getLatLng());\n  };\n\n  const handleLoad = () => {\n    onLoad();\n    onPinMove(DEFAULT_COORD);\n  };\n\n  MAP\n    .on('load', handleLoad)\n    .setView(DEFAULT_COORD, VIEW_MAP);\n\n  LEAFLET.tileLayer(\n    LEAFLET_TILE_URL,\n    {\n      attribution: LEAFLET_ATTR,\n    },\n  ).addTo(MAP);\n\n  const mainIcon = LEAFLET.icon(MAIN_ICON);\n  mainMarker = LEAFLET.marker(\n    DEFAULT_COORD,\n    {\n      draggable: true,\n      icon: mainIcon,\n    },\n  );\n  mainMarker.addTo(MAP);\n  mainMarker.on('move', mainPinMoveHandler);\n}\n\nexport {initMap, DEFAULT_COORD, addPins, removePins, moveMainMarkerDefault}\n","const getNodes = (selectors, parent) => {\n  let nodes = {}\n  const keys = Object.entries(selectors);\n\n  for (let [key, value] of keys) {\n    nodes[key] = parent.querySelector(value);\n  }\n\n  return nodes;\n};\n\nconst pluralize = (n, variants) => {\n  return variants[[(n % 10 === 1 && n % 100 !== 11) ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2]];\n};\n\nconst getRoundNumber = (number, digits = 5) => {\n  let degree =  Math.pow(10, digits);\n  return Math.round(number * degree) / degree;\n};\n\nconst isEscEvent = (evt) => {\n  return evt.key === 'Escape' || evt.key === 'Esc';\n};\n\nconst hasObjKey = (obj, key) => {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n};\n\nexport {getNodes, pluralize, getRoundNumber, isEscEvent, hasObjKey};\n","import {getRoundNumber, getNodes, pluralize} from './utils.js';\n\nconst CARD_TEMPLATE = document.querySelector('#card');\n\nconst POPUP_SELECTORS = {\n  feature: '.popup__feature',\n  photo: '.popup__photo',\n};\n\nconst HOUSE_TYPES = {\n  palace: 'Дворец',\n  flat: 'Квартира',\n  house: 'Дом',\n  bungalow: 'Бунгало',\n};\n\nconst SELECTORS = {\n  title: '.popup__title',\n  address: '.popup__text--address',\n  price: '.popup__text--price',\n  type: '.popup__type',\n  capacity: '.popup__text--capacity',\n  time: '.popup__text--time',\n  features: '.popup__features',\n  description: '.popup__description',\n  photos: '.popup__photos',\n  avatar: '.popup__avatar',\n};\n\nconst ROOMS_OPTIONS = [\n  'комната',\n  'комнаты',\n  'комнат',\n];\n\nconst GUESTS_OPTIONS = [\n  'гостя',\n  'гостей',\n  'гостей',\n];\n\nconst getHouseType = (type) => {\n  return HOUSE_TYPES[type];\n};\n\nconst prepareFeatures = (parent, features) => {\n  let children = parent.querySelectorAll(POPUP_SELECTORS.feature);\n\n  children.forEach(function(child) {\n    child.classList.add('hidden');\n    features.forEach(function(feature) {\n      if (child.className.includes(feature)) {\n        child.classList.remove('hidden');\n      }\n    })\n  })\n\n};\n\nconst renderPhotos = (parent, photos) => {\n  const imgElement = parent.querySelector(POPUP_SELECTORS.photo);\n  const img = imgElement.cloneNode(true);\n  const fragment = document.createDocumentFragment();\n\n  parent.removeChild(imgElement);\n\n  photos.forEach(function(elem) {\n    let newImg = img.cloneNode(true);\n    newImg.setAttribute('src', elem);\n    fragment.appendChild(newImg);\n  })\n\n  return fragment;\n};\n\nconst getCapacityText = (offer) => {\n  const rooms = pluralize(offer.rooms, ROOMS_OPTIONS);\n  const guests = pluralize(offer.rooms, GUESTS_OPTIONS);\n\n  return `${offer.rooms} ${rooms} для ${offer.guests} ${guests}`;\n};\n\nconst getAddressCoords = ({lat, lng}) => {\n  return `${getRoundNumber(lat)}, ${getRoundNumber(lng)}`;\n};\n\nconst fillCard = (cardData) => {\n  const ad = CARD_TEMPLATE.content.cloneNode(true);\n  const adNodes = getNodes(SELECTORS, ad);\n\n  adNodes.title.textContent = cardData.offer.titles;\n  adNodes.address.textContent = getAddressCoords(cardData.location);\n  adNodes.price.innerHTML = `${cardData.offer.price} <span>₽/ночь</span>`;\n  adNodes.type.textContent = getHouseType(cardData.offer.type);\n  adNodes.capacity.textContent = getCapacityText(cardData.offer);\n  adNodes.time.textContent = `Заезд после ${cardData.offer.checkin}, выезд до ${cardData.offer.checkout}`;\n  prepareFeatures(adNodes.features, cardData.offer.features);\n  adNodes.description.textContent = cardData.offer.description;\n  adNodes.photos.appendChild(renderPhotos(adNodes.photos, cardData.offer.photos));\n  adNodes.avatar.src = cardData.author.avatar;\n\n  return ad;\n};\n\nexport {fillCard};\n","let rawData = null;\nlet preparedData = null;\n\nconst MAX_PIN = 10;\n\n/**\n * Возвращает первые MAX_PIN_COUNT из массива data\n * @param {*} data\n */\nconst sliceCounts = (data) => data.slice(0, MAX_PIN);\n\n/**\n * Подготавливает сырые данные\n * Сохраняет результат в preparedData\n * @param {*} filterData - ф-ия фильтр\n */\nconst prepareData = (filterData) => {\n  if (!rawData) {\n    throw new Error('Ошибка вызова данных!');\n  }\n\n  let data = rawData;\n\n  if (typeof filterData === 'function') {\n    data = data.filter(filterData);\n  }\n  if (data.length > MAX_PIN) {\n    data = sliceCounts(data);\n  }\n  preparedData = data;\n};\n\nconst getData = () => preparedData;\n\n/**\n * Сохраняет сырые данные\n * Вызывает prepareData с дефолтными настройками\n * @param {*} data\n */\nconst storeData = (data) => {\n  rawData = data;\n  prepareData();\n};\n\nexport {storeData, getData, prepareData}\n","import {isEscEvent} from './utils.js'\n\nconst MAIN_BLOCK = document.querySelector('main');\nconst POPUP_ZINDEX = '10000';\n\nconst onPopupEscKeydown = (evt) => {\n  if (isEscEvent(evt)) {\n    evt.preventDefault();\n    closePopup(MAIN_BLOCK);\n  }\n};\n\nconst onPopupClick = () => {\n  closePopup(MAIN_BLOCK);\n};\n\nconst openPopup = (node, parent, className = '.success') => {\n  const cloneElement = node.content.cloneNode(true);\n  const popup = cloneElement.querySelector(className);\n  popup.style.zIndex = POPUP_ZINDEX;\n  parent.appendChild(popup);\n  document.addEventListener('keydown', onPopupEscKeydown);\n  document.addEventListener('click', onPopupClick);\n};\n\nconst closePopup = (parent) => {\n  const lastChild = parent.lastElementChild;\n  parent.removeChild(lastChild);\n  document.removeEventListener('keydown', onPopupEscKeydown);\n  document.removeEventListener('click', onPopupClick);\n};\n\nexport {openPopup, closePopup}\n","import {sendData} from './api.js';\nimport {openPopup} from './popup.js';\nimport {getRoundNumber} from './utils.js';\nimport {DEFAULT_COORD, moveMainMarkerDefault} from './map.js';\n\nconst AD_FORM = document.querySelector('.ad-form');\nconst AD_FORM_RESET = document.querySelector('.ad-form__reset');\nconst MAP_FILTERS = document.querySelector('.map__filters');\nconst MAIN_BLOCK = document.querySelector('main');\nconst PHOTO_AVATAR_PREVIEW = AD_FORM.querySelector('.ad-form-header__preview img');\nconst PHOTO_HOUSE_PREVIEW = AD_FORM.querySelector('.ad-form__photo');\nconst CLONE_PHOTO = PHOTO_AVATAR_PREVIEW.cloneNode(true);\nconst POPUP_SUCCESS_TEMPLATE = document.querySelector('#success');\nconst POPUP_ERROR_TEMPLATE = document.querySelector('#error');\n\nconst FieldNodes = {\n  TYPE: AD_FORM.querySelector('#type'),\n  PRICE: AD_FORM.querySelector('#price'),\n  TIMEIN: AD_FORM.querySelector('#timein'),\n  TIMEOUT: AD_FORM.querySelector('#timeout'),\n  ADDRESS: AD_FORM.querySelector('#address'),\n  ROOM_NUMBER: AD_FORM.querySelector('#room_number'),\n  CAPACITY: AD_FORM.querySelector('#capacity'),\n  PHOTO_AVATAR: AD_FORM.querySelector('#avatar'),\n  PHOTO_HOUSE: AD_FORM.querySelector('#images'),\n};\n\nconst DEFAULT_PRICE_PLACEHOLDER = '1000';\n\nconst FILE_TYPES = [\n  'gif',\n  'jpg',\n  'jpeg',\n  'png',\n];\n\nconst CloneSize = {\n  width: '70',\n  height: '70',\n};\n\nconst HOUSE_PRICE = {\n  palace: 10000,\n  flat: 1000,\n  house: 5000,\n  bungalow: 0,\n};\n\nconst ROOMS_VALUES = {\n  1: ['1'],\n  2: ['1', '2'],\n  3: ['1', '2', '3'],\n  100: ['0'],\n};\n\nconst fieldPhotoAvatarChangeHandler = (evt) => {\n  const FILE = evt.target.files[0];\n  const FILE_NAME = FILE.name.toLowerCase();\n\n  const matches = FILE_TYPES.some((file) => {\n    return FILE_NAME.endsWith(file)\n  })\n\n  if (matches) {\n    const READER = new FileReader();\n\n    READER.addEventListener('load', () => {\n      PHOTO_AVATAR_PREVIEW.src = READER.result;\n    })\n\n    READER.readAsDataURL(FILE);\n  }\n};\n\nconst fieldPhotoHouseChangeHandler = (evt) => {\n  const FILE = evt.target.files[0];\n  const FILE_NAME = FILE.name.toLowerCase();\n\n  const matches = FILE_TYPES.some((file) => {\n    return FILE_NAME.endsWith(file)\n  })\n\n  if (matches) {\n    const READER = new FileReader();\n\n    READER.addEventListener('load', () => {\n      const CLONE = CLONE_PHOTO;\n      CLONE.src = READER.result;\n      CLONE.width = CloneSize.width;\n      CLONE.height = CloneSize.height;\n      PHOTO_HOUSE_PREVIEW.appendChild(CLONE);\n    })\n\n    READER.readAsDataURL(FILE);\n  }\n};\n\nconst fieldRoomNumberChangeHandler = (evt) => {\n  let value = evt.target.value;\n  let options = FieldNodes.CAPACITY.querySelectorAll('option');\n  options.forEach(function (elem) {\n    changeAttribute(elem, 'selected', 'disabled');\n    if (ROOMS_VALUES[value].includes(elem.value)) {\n      changeAttribute(elem, 'disabled', 'selected');\n    }\n  })\n};\n\nconst changeAttribute = (elem, attr1, attr2) => {\n  elem.removeAttribute(attr1);\n  elem.setAttribute(attr2, '');\n};\n\nconst disableFormFields = (node, childFields, classNode = 'ad-form--disabled') => {\n  node.classList.add(classNode);\n  let children = node.querySelectorAll(childFields);\n  children.forEach((elem) => elem.setAttribute('disabled', ''));\n};\n\nconst enableFormFields = (node, childFields, classNode = 'ad-form--disabled') => {\n  node.classList.remove(classNode);\n  let children = node.querySelectorAll(childFields);\n  children.forEach((elem) => elem.removeAttribute('disabled'));\n};\n\nconst fieldTypeChangeHandler = (evt) => {\n  let value = evt.target.value;\n  FieldNodes.PRICE.setAttribute('placeholder', HOUSE_PRICE[value]);\n  FieldNodes.PRICE.setAttribute('min', HOUSE_PRICE[value]);\n};\n\nconst fieldTimeinChangeHandler = (evt) => {\n  FieldNodes.TIMEOUT.value = evt.target.value;\n};\n\nconst fieldTimeoutChangeHandler = (evt) => {\n  FieldNodes.TIMEIN.value = evt.target.value;\n};\n\nconst resetFormHandler = (evt) => {\n  evt.preventDefault();\n  AD_FORM.reset();\n  MAP_FILTERS.reset();\n  moveMainMarkerDefault();\n  setAddress(DEFAULT_COORD);\n  FieldNodes.PRICE.setAttribute('placeholder', DEFAULT_PRICE_PLACEHOLDER);\n};\n\nconst submitFormHandler = (evt) => {\n  evt.preventDefault();\n\n  const formData = new FormData(evt.target);\n  const dataPromise = sendData(formData);\n\n  dataPromise\n    .then(() => {\n      openPopup(POPUP_SUCCESS_TEMPLATE, MAIN_BLOCK);\n      resetFormHandler(evt);\n    })\n    .catch(() => {\n      openPopup(POPUP_ERROR_TEMPLATE, MAIN_BLOCK, '.error');\n    })\n};\n\nconst getFilterChangeHandle = (setSelect, setCheckbox) => (evt) => {\n  const field = evt.target;\n  if (field.tagName === 'SELECT') {\n    setSelect(field.id, field.value);\n    return;\n  }\n  if (field.tagName === 'INPUT') {\n    setCheckbox(field.id, field.checked);\n    return;\n  }\n};\n\nlet filterChangeHandler;\n\nconst addEventListeners = () => {\n  const {TYPE, TIMEIN, TIMEOUT, ROOM_NUMBER, PHOTO_AVATAR, PHOTO_HOUSE} = FieldNodes;\n\n  TYPE.addEventListener('change', fieldTypeChangeHandler);\n  TIMEIN.addEventListener('change', fieldTimeinChangeHandler);\n  TIMEOUT.addEventListener('change', fieldTimeoutChangeHandler);\n  ROOM_NUMBER.addEventListener('change', fieldRoomNumberChangeHandler);\n  AD_FORM.addEventListener('submit', submitFormHandler);\n  AD_FORM_RESET.addEventListener('click', resetFormHandler);\n  PHOTO_AVATAR.addEventListener('change', fieldPhotoAvatarChangeHandler);\n  PHOTO_HOUSE.addEventListener('change', fieldPhotoHouseChangeHandler);\n};\n\nconst removeEventListeners = () => {\n  const {TYPE, TIMEIN, TIMEOUT, ROOM_NUMBER, PHOTO_AVATAR, PHOTO_HOUSE} = FieldNodes;\n\n  TYPE.removeEventListener('change', fieldTypeChangeHandler);\n  TIMEIN.removeEventListener('change', fieldTimeinChangeHandler);\n  TIMEOUT.removeEventListener('change', fieldTimeoutChangeHandler);\n  ROOM_NUMBER.removeEventListener('change', fieldRoomNumberChangeHandler);\n  AD_FORM.removeEventListener('submit', submitFormHandler);\n  AD_FORM_RESET.removeEventListener('click', resetFormHandler);\n  PHOTO_AVATAR.removeEventListener('change', fieldPhotoAvatarChangeHandler);\n  PHOTO_HOUSE.removeEventListener('change', fieldPhotoHouseChangeHandler);\n};\n\nconst disableForms = () => {\n  disableFormFields(AD_FORM, 'fieldset');\n  disableFormFields(MAP_FILTERS, 'select');\n  disableFormFields(MAP_FILTERS, 'fieldset');\n  removeEventListeners();\n  MAP_FILTERS.removeEventListener('change', filterChangeHandler);\n  filterChangeHandler = null;\n};\n\nconst enableForms = (setSelect, setCheckbox) => {\n  filterChangeHandler = getFilterChangeHandle(setSelect, setCheckbox);\n  MAP_FILTERS.addEventListener('change', filterChangeHandler);\n  enableFormFields(MAP_FILTERS, 'select');\n  enableFormFields(MAP_FILTERS, 'fieldset');\n  addEventListeners();\n};\n\nconst enableAdFiltersForms = () => {\n  addEventListeners();\n  enableFormFields(AD_FORM, 'fieldset');\n};\n\nconst setAddress = ({lat, lng}) => {\n  FieldNodes.ADDRESS.value = `${getRoundNumber(lat)}, ${getRoundNumber(lng)}`;\n};\n\nexport {disableForms, setAddress, enableForms, enableAdFiltersForms}\n","const GETDATA_URL = 'https://22.javascript.pages.academy/keksobooking/data';\nconst SETDATA_URL = 'https://22.javascript.pages.academy/keksobooking';\n\nconst loadData = () => {\n  return fetch(GETDATA_URL)\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      }\n\n      throw new Error(`${response.status} ${response.statusText}`);\n    })\n};\n\nconst sendData = (form) => {\n  return fetch(\n    SETDATA_URL,\n    {\n      method: 'POST',\n      body: form,\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      }\n\n      throw new Error(`${response.status} ${response.statusText}`);\n    })\n};\n\nexport {loadData, sendData}\n","import {hasObjKey} from './utils.js';\n\nconst DEFAULT_FEATURES_VALUES = {\n  'filter-wifi': false,\n  'filter-dishwasher': false,\n  'filter-parking': false,\n  'filter-washer': false,\n  'filter-elevator': false,\n  'filter-conditioner': false,\n};\n\nconst SelectKeys = {\n  TYPE: 'housing-type',\n  PRICE: 'housing-price',\n  ROOMS: 'housing-rooms',\n  GUESTS: 'housing-guests',\n};\n\nconst DEFAULT_VALUES = {\n  [SelectKeys.TYPE]: '',\n  [SelectKeys.PRICE]: '',\n  [SelectKeys.ROOMS]: '',\n  [SelectKeys.GUESTS]: '',\n};\n\nconst Price = {\n  LOW: 10000,\n  HIGH: 50000,\n};\n\nconst TYPE_PRICE = {\n  'all': 'any',\n  'budget': 'low',\n  'average': 'middle',\n  'rich': 'high',\n};\n\nconst checkPrice = (type, price) => {\n  switch (type) {\n    case TYPE_PRICE.all:\n      return true;\n    case TYPE_PRICE.budget:\n      return price < Price.LOW;\n    case TYPE_PRICE.average:\n      return price >= Price.LOW && price < Price.HIGH;\n    case TYPE_PRICE.rich:\n      return price >= Price.HIGH;\n    default:\n      return false;\n  }\n};\n\nconst getDefaultValues = () => ({\n  ...DEFAULT_VALUES,\n  ...DEFAULT_FEATURES_VALUES,\n});\n\nconst actualValues = getDefaultValues();\n\nconst setFieldValue = (key, value) => {\n  if (hasObjKey(DEFAULT_VALUES, key)) {\n    actualValues[key] = value;\n  } else {\n    throw new Error(`Ошибка, отсутствует ключ ${key}`);\n  }\n};\n\nconst setCheckboxValue = (key, value) => {\n  if (hasObjKey(DEFAULT_FEATURES_VALUES, key)) {\n    actualValues[key] = value;\n  } else {\n    throw new Error(`Ошибка, отсутствует ключ ${key}`);\n  }\n};\n\nconst checkFeatures = (features) => {\n  for (let key in DEFAULT_FEATURES_VALUES) {\n    if (actualValues[key] && !features.includes(key.replace('filter-', ''))) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst checkSelectKeys = (key, type, price = false) => {\n  if (price) {\n    return (actualValues[key] && actualValues[key] !== 'any' && !checkPrice(actualValues[key], type))\n  }\n\n  return (actualValues[key] && actualValues[key] !== 'any' && `${type}` !== actualValues[key])\n};\n\nconst checkData = (data) => {\n  if (checkSelectKeys(SelectKeys.TYPE, data.offer.type) ||\n      checkSelectKeys(SelectKeys.PRICE, data.offer.price, true) ||\n      checkSelectKeys(SelectKeys.ROOMS, data.offer.rooms) ||\n      checkSelectKeys(SelectKeys.GUESTS, data.offer.guests)) {\n    return false\n  }\n\n  return checkFeatures(data.offer.features);\n};\n\nexport {setFieldValue, setCheckboxValue, checkData}\n","import {initMap, addPins, removePins} from './map.js';\nimport {fillCard} from './ads.js';\nimport {storeData, getData, prepareData} from './store.js';\nimport {disableForms, enableForms, setAddress, enableAdFiltersForms} from './form.js';\nimport {loadData} from './api.js';\nimport {setFieldValue, setCheckboxValue, checkData} from './filter.js';\n\n/* global _:readonly */\n\nconst RENDER_TIMEOUT = 500;\nconst ALERT_TIMEOUT = 3000;\n\nconst adaptPoints = (ad) => ({\n  title: ad.offer.title,\n  lat: ad.location.lat,\n  lng: ad.location.lng,\n});\n\nconst renderPins = (data) => {\n  const points = data.map(adaptPoints);\n  const renderAd = (idx) => fillCard(data[idx]);\n\n  removePins();\n  addPins(points, renderAd);\n};\n\nconst updatePins = () => {\n  prepareData(checkData);\n  removePins();\n  renderPins(getData());\n};\n\nconst updatePinsDebounced = _.debounce(updatePins, RENDER_TIMEOUT);\n\nconst handleDataSuccess = (rawData) => {\n  storeData(rawData);\n  enableForms(handleSelectChange, handleCheckboxChange);\n  renderPins(getData());\n};\n\nconst handleDataError = () => {\n  const alertContainer = document.createElement('div');\n  alertContainer.classList.add('alert');\n  const message = 'Данные не загрузились';\n  alertContainer.textContent = message;\n  document.body.append(alertContainer);\n\n  setTimeout(alertContainer.remove, ALERT_TIMEOUT);\n};\n\nconst handleMapLoaded = () => {\n  enableAdFiltersForms();\n  loadData()\n    .then(handleDataSuccess)\n    .catch(handleDataError)\n};\n\nconst handleSelectChange = (...args) => {\n  setFieldValue(...args);\n  updatePinsDebounced();\n};\n\nconst handleCheckboxChange = (...args) => {\n  setCheckboxValue(...args);\n  updatePinsDebounced();\n};\n\ndisableForms();\ninitMap(handleMapLoaded, setAddress);\n"],"sourceRoot":""}